
// google sheet of the year where the term ends. Ex. 2014-15 year would be the _15 var
var _2015 = "https://spreadsheets.google.com/feeds/list/1YmNn1kwgAk_-_Zmo6kRGlwZYeMEu8p7VvYSZ4CilQeI/1/public/values?alt=json";
var _2014 = "https://spreadsheets.google.com/feeds/list/1YmNn1kwgAk_-_Zmo6kRGlwZYeMEu8p7VvYSZ4CilQeI/2/public/values?alt=json";
var _2013 = "https://spreadsheets.google.com/feeds/list/1YmNn1kwgAk_-_Zmo6kRGlwZYeMEu8p7VvYSZ4CilQeI/3/public/values?alt=json";
var all = "https://spreadsheets.google.com/feeds/list/1YmNn1kwgAk_-_Zmo6kRGlwZYeMEu8p7VvYSZ4CilQeI/4/public/values?alt=json";

var allison = {name: "Allison R.", _2013: "img/2013/allison.jpg", _2014: "img/2014/allison.jpg", _2015: "img/2015/allison.jpg", all: "img/2015/allison.jpg"};
var andy = {name: "Andy N.", _2013: "img/2013/andy.jpg", _2014: "img/2014/andy.jpg", _2015: "img/2015/andy.jpg", all: "img/2015/andy.jpg"};
var anne = {name: "Anne L.", _2013: "img/2013/anne.jpg", _2014: "img/2014/anne.jpg", _2015: "img/2015/anne.jpg", all: "img/2015/anne.jpg"};
var benjamin = {name: "Benjamin Y.", _2013: "", _2014: "img/2014/benjamin.jpg", _2015: "img/2015/benjamin.jpg", all: "img/2015/benjamin.jpg"};
var brandon = {name: "Brandon L.", _2013: "img/2013/brandon.jpg", _2014: "img/2014/brandon.jpg", _2015: "img/2015/brandon.jpg", all: "img/2015/brandon.jpg"};
var brian = {name: "Brian C.", _2013: "img/2013/brian.jpg", _2014: "img/2014/brian.jpg", _2015: "img/2015/brian.jpg", all: "img/2015/brian.jpg"};
var cindy = {name: "Cindy L.", _2013: "", _2014: "", _2015: "img/2015/cindy.jpg", all: "img/2015/cindy.jpg"};
var erik = {name: "Erik L.", _2013: "img/2013/erik.jpg", _2014: "img/2014/erik.jpg", _2015: "img/2015/erik.jpg", all: "img/2015/erik.jpg"};
var frederick = {name: "Frederick S.", _2013: "", _2014: "img/2014/frederick.jpg", _2015: "img/2015/frederick.jpg", all: "img/2015/frederick.jpg"};
var henry = {name: "Henry N.", _2013: "", _2014: "", _2015: "img/2015/Henry.jpg", all: "img/2015/Henry.jpg"};
var jennifer = {name: "Jennifer C.", _2013: "", _2014: "", _2015: "img/2015/jennifer.jpg", all: "img/2015/jennifer.jpg"};
var jeremy = {name: "Jeremy C.", _2013: "", _2014: "img/2014/jeremy.jpg", _2015: "img/2015/jeremy.jpg", all: "img/2015/jeremy.jpg"};
var johnny = {name: "Johnny L.", _2013: "img/2013/johnny.jpg", _2014: "img/2014/johnny.jpg", _2015: "img/2015/johnny.jpg", all: "img/2015/johnny.jpg"};
var ken = {name: "Ken P.", _2013: "", _2014: "img/2014/ken.jpg", _2015: "img/2015/ken.jpg", all: "img/2015/ken.jpg"};
var kiml = {name: "Kim L.", _2013: "", _2014: "img/2014/kiml.jpg", _2015: "img/2015/kiml.jpg", all: "img/2015/kiml.jpg"};
var kimn = {name: "Kim N.", _2013: "", _2014: "", _2015: "img/2015/kimn.jpg", all: "img/2015/kimn.jpg"};
var kirstie = {name: "Kirstie D.", _2013: "", _2014: "", _2015: "img/2015/kirstie.jpg", all: "img/2015/kirstie.jpg"};
var korynn = {name: "Korynn A.", _2013: "", _2014: "", _2015: "img/2015/korynn.jpg", all: "img/2015/korynn.jpg"};
var lesley = {name: "Lesley C.", _2013: "", _2014: "", _2015: "img/2015/lesley.jpg", all: "img/2015/lesley.jpg"};
var melinda = {name: "Melinda T.", _2013: "", _2014: "", _2015: "img/2015/melinda.jpg", all: "img/2015/melinda.jpg"};
var nicholas = {name: "Nicholas C.", _2013: "img/2013/nicholas.jpg", _2014: "img/2014/nicholas.jpg", _2015: "img/2015/nicholas.jpg", all: "img/2015/nicholas.jpg"};
var olivia = {name: "Olivia L.", _2013: "", _2014: "img/2014/olivia.jpg", _2015: "img/2015/olivia.jpg", all: "img/2015/olivia.jpg"};
var raymond = {name: "Raymond C.", _2013: "", _2014: "", _2015: "img/2015/raymond.jpg", all: "img/2015/raymond.jpg"};
var rebeccah = {name: "Rebeccah H.", _2013: "", _2014: "img/2014/rebeccah.jpg", _2015: "img/2015/rebeccah.jpg", all: "img/2015/rebeccah.jpg"};
var ronnie = {name: "Ronnie N.", _2013: "img/2013/ronnie.jpg", _2014: "img/2014/ronnie.jpg", _2015: "img/2015/ronnie.jpg", all: "img/2015/ronnie.jpg"};
var roseland = {name: "Roseland L.", _2013: "", _2014: "img/2014/roseland.jpg", _2015: "img/2015/roseland.jpg", all: "img/2015/roseland.jpg"};
var sabrina = {name: "Sabrina N.", _2013: "img/2013/sabrina.jpg", _2014: "img/2014/sabrina.jpg", _2015: "img/2015/sabrina.jpg", all: "img/2015/sabrina.jpg"};
var steven = {name: "Steven B.", _2013: "img/2013/steven.jpg", _2014: "img/2014/steven.jpg", _2015: "img/2015/steven.jpg", all: "img/2015/steven.jpg"};
var thomas = {name: "Thomas T.", _2013: "img/2013/thomas.jpg", _2014: "img/2014/thomas.jpg", _2015: "img/2015/thomas.jpg", all: "img/2015/thomas.jpg"};

var members = {"Allison R.": allison, "Andy N.": andy, "Anne L.": anne, "Benjamin Y.": benjamin, "Brandon L.": brandon, 
	"Brian C.": brian, "Cindy L.": cindy, "Erik L.": erik, "Frederick S.": frederick, "Henry N.": henry, "Jennifer C.": jennifer, 
	"Jeremy C.": jeremy, "Johnny L.": johnny, "Ken P.": ken, "Kim L.": kiml, "Kim N.": kimn, "Kirstie D.": kirstie, 
	"Korynn A.": korynn, "Lesley C.": lesley, "Melinda T.": melinda, "Nicholas C.": nicholas, "Olivia L.": olivia,
	"Raymond C.": raymond, "Rebeccah H.": rebeccah, "Ronnie N.": ronnie, "Roseland L.": roseland, "Sabrina N.": sabrina,
	"Steven B.": steven, "Thomas T.": thomas};

var team_pics = {"_2013": "img/2013/team.jpg", "_2014": "img/2014/team.jpg", "_2015": "img/2015/team.jpg", "all": "img/2015/team.jpg"};
var selected_team = [];
var total_temp = 0;

var current = "";

$(document).ready(function(){
	$("#all").click(function(){
		display("all");
		if (current != "all"){
			current = "all";
		}
		else {
			current = "";
		}
	});

	$("#btn-15").click(function(){
		display("2015");
		if (current != "2015"){
			current = "2015";
		}
		else {
			current = "";
		}
	});

	$("#btn-14").click(function(){
		display("2014");
		if (current !="2014"){
			current = "2014";
		}
		else {
			current = "";
		}
	});

	$("#btn-13").click(function(){
		display("2013");
		if(current != "2013"){
			current = "2013"
		}
		else {
			current = "";
		}
	});

	$('a[href*=#]').click(function() {
	    if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
	    && location.hostname == this.hostname) {
	      var $target = $(this.hash);
	      $target = $target.length && $target
	      || $('[name=' + this.hash.slice(1) +']');
	      if ($target.length) {
	        var targetOffset = $target.offset().top - 50;
	        $('html,body')
	        .animate({scrollTop: targetOffset}, 1000);
	       return false;
	      }
	    }
	  });
});

var display = function(year){
	clearRoster();
	selected_team = [];
	if (current != year){
		if(year === "all"){
			$(".roster-header").prepend("<h1 class='year'>2012-2015</h1>");
		}
		else if(year === "2015"){
			$(".roster-header").prepend("<h1 class='year'>2014-2015</h1>");
		}
		else if (year === "2014"){
			$(".roster-header").prepend("<h1 class='year'>2013-2014</h1>");
		}
		else if (year === "2013"){
			$(".roster-header").prepend("<h1 class='year'>2012-2013</h1>");
		}

		$(".roster-header").append("<div id='sort'><b>Sort By:</b><a id='by_name'> NAME</a><a id='by_lion'> LION</a><a id='by_drum'> DRUM</a><a id='by_other'> OTHER</a><a id='by_total'> TOTAL</a></div>");

		$("#by_name").click(function(){
			selected_team.sort(compareName);
			redisplay(year);
		});
		$("#by_lion").click(function(){
			selected_team.sort(compareLion);
			redisplay(year);
		});
		$("#by_drum").click(function(){
			selected_team.sort(compareDrum);
			redisplay(year);
		});
		$("#by_other").click(function(){
			selected_team.sort(compareOther);
			redisplay(year);
		});
		$("#by_total").click(function(){
			selected_team.sort(compareTotal);
			redisplay(year);
		});

		addIndividuals(year);
		addTeam(year);
	}
}

var redisplay = function(year){
$(".roster-ind").empty();
$(".roster-ind").append("<h2>Individual</h2>");
	if (year === "all"){
		year = all;
		year_index = "all";
	}
	else if (year === "2015"){
		year = _2015;
		year_index = "_2015"
	}
	else if (year === "2014"){
		year = _2014;
		year_index = "_2014"
	}
	else if (year === "2013"){
		year = _2013;
		year_index = "_2013"
	}

	numPeople = selected_team.length;
	var all_perf = total_temp;

	for(i = 0; i < numPeople; i++){
		name = selected_team[i].name;
		lion = selected_team[i].lion;
		drum = selected_team[i].drum;
		other = selected_team[i].other;
		total = selected_team[i].total;

		if(year === all){
			joined = selected_team[i].joined;
		}

		$(".roster-ind").append("<div id='" + i + "' class='col-xs-4 ind'>" +"<img src='" + members[name][year_index] + "' width='280px;'><h1 class='name'>" + name + "</h1><div class='ind-stats'><div class='category col-xs-4'> <b>Lion: </b>" + lion + "</div><div class='category col-xs-4'><b>Drum: </b>" + drum + "</div><div class='category col-xs-4'> <b>Other: </b>" + other + "</div><div class='category col-xs-12'>Lioned <b>" + Math.ceil(lion/all_perf * 100) + "%</b> of total performances </div><div class='category col-xs-12'>Drummed <b>" + Math.ceil(drum/all_perf * 100) + "%</b> of total performances </div><div class='category col-xs-12'>Participated in <b>" + Math.ceil(total/all_perf * 100) + "%</b> of total performances </div><div class='category col-xs-12'><b>Total: </b>" + total + "</div></div></div>");

		if(year === all){
			$("#"+i).append("<div class='category col-xs-12'><b>Joined: </b>" + joined + "</div>");
		}
	}
}

function compareName(a,b) {
		if(a.name < b.name){
			return -1;
		}
		return 1; 
}

function compareLion(a,b) {
		if(parseInt(a.lion) < parseInt(b.lion)){
			return 1;
		}
		return -1;
}

function compareDrum(a,b) {
		if(parseInt(a.drum) < parseInt(b.drum)){
			return 1;
		}
		return -1;
}

function compareOther(a,b) {
		if(parseInt(a.other) < parseInt(b.other)){
			return 1;
		}
		return -1;
}

function compareTotal(a,b) {
		if(parseInt(a.total) < parseInt(b.total)){
			return 1;
		}
		return -1;
}

var clearRoster = function(){
	$(".roster-header").empty();
	$(".roster-ind").empty();
	$(".roster-team").empty();
}

var addIndividuals = function(year){
	$(".roster-ind").append("<h2>Individual</h2>");
	if (year === "all"){
		year = all;
		year_index = "all";
	}
	else if (year === "2015"){
		year = _2015;
		year_index = "_2015"
	}
	else if (year === "2014"){
		year = _2014;
		year_index = "_2014"
	}
	else if (year === "2013"){
		year = _2013;
		year_index = "_2013"
	}
	$.getJSON(year, function(data){
		numPeople = data.feed.entry.length-2;
		var all_perf = data.feed.entry[numPeople].gsx$lion.$t;
		total_temp = all_perf;
		for(i = 0; i < numPeople; i++){
			name = data.feed.entry[i].title.$t;
			lion = data.feed.entry[i].gsx$lion.$t;
			drum = data.feed.entry[i].gsx$drum.$t;
			other = data.feed.entry[i].gsx$other.$t;
			total = data.feed.entry[i].gsx$total.$t;

			if(year === all){
				joined = data.feed.entry[i].gsx$joined.$t;
				person = {name: name, lion: lion, drum: drum, other: other, total: total, joined: joined};
			} else {
				person = {name: name, lion: lion, drum: drum, other: other, total: total};
			}
			selected_team.push(person);

			$(".roster-ind").append("<div id='" + i + "' class='col-xs-4 ind'>" +"<img src='" + members[name][year_index] + "' width='280px;'><h1 class='name'>" + name + "</h1><div class='ind-stats'><div class='category col-xs-4'> <b>Lion: </b>" + lion + "</div><div class='category col-xs-4'><b>Drum: </b>" + drum + "</div><div class='category col-xs-4'> <b>Other: </b>" + other + "</div><div class='category col-xs-12'>Lioned <b>" + Math.ceil(lion/all_perf * 100) + "%</b> of total performances </div><div class='category col-xs-12'>Drummed <b>" + Math.ceil(drum/all_perf * 100) + "%</b> of total performances </div><div class='category col-xs-12'>Participated in <b>" + Math.ceil(total/all_perf * 100) + "%</b> of total performances </div><div class='category col-xs-12'><b>Total: </b>" + total + "</div></div></div>");

			if(year === all){
				$("#"+i).append("<div class='category col-xs-12'><b>Joined: </b>" + joined + "</div>");
			}
		}
	});
}

var addTeam = function(year){
	$(".roster-team").append("<h2>Team</h2>");
	var actual_roster = 0;
	if (year === "all"){
		year = all;
		year_index = "all";
	}
	else if (year === "2015"){
		year = _2015;
		year_index = "_2015"
	}
	else if (year === "2014"){
		year = _2014;
		year_index = "_2014"
	}
	else if (year === "2013"){
		year = _2013;
		year_index = "_2013"
	}

	$.getJSON(year, function(data){
		numPeople = data.feed.entry.length-2;
		var all_perf = data.feed.entry[numPeople].gsx$lion.$t;
		var rej_perf = data.feed.entry[numPeople+1].gsx$lion.$t;
		var total = (parseInt(all_perf) + parseInt(rej_perf));
		var perc_accept = Math.ceil(all_perf/total * 100);

		var num_lions = 0;
		var num_drums = 0;

		for(i=0;i<numPeople;i++){
			if(data.feed.entry[i].gsx$lion.$t > 0){
				num_lions++;
			}
			if(data.feed.entry[i].gsx$drum.$t > 0){
				num_drums++;
			}
		}

		var title = "";
		if (year === all){
			title = "Summary";
		} 
		else {
			title = (parseInt(current)-1) + "/" + current;
		}
		$(".roster-team").append("<div id='team_stats' class='col-xs-12'>" + 
			"<img src='" + team_pics[year_index] + "'>" +
			"<h1 class='team_name'>SYT " + title + "</h1>" +
			"<div class='col-xs-12 total'> <b>Total Performances:</b> " + all_perf + "</div>" +
			"<div class='col-xs-12 requests'> <b>Total Requests:</b> " + total + "</div>" +
			"<div class='col-xs-12 req_perc'> Accepted <b>" + perc_accept + "%</b> of all requests </div>" +
			"<div class='col-xs-12 lion_perc'> Percent of this roster that has lioned <b>" + Math.ceil(num_lions/numPeople * 100) +
			"%</b></div>" + 
			"<div class='col-xs-12 drum_perc'> Percent of this roster that has drummed <b>" + Math.ceil(num_drums/numPeople * 100) +
			"%</b></div>");

	});
}